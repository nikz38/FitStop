/*! FitStop 1.0.0 09-07-2016 */
var app=angular.module("fitstop",["ui.router","ngSanitize"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider",function(a,b,c,d){b.otherwise(function(a){var b=a.get("$state");b.go("layout.login")}),a.state("layout",{controller:"LayoutController",templateUrl:"/views/layout.html"}).state("layout.login",{url:"/login",controller:"LoginController",templateUrl:"/views/login.html"}).state("layout.register",{url:"/register",controller:"RegisterController",templateUrl:"/views/register.html"}).state("layout.reset-password",{url:"/reset-password",templateUrl:"/views/reset-password.html"}).state("layout.dashboard",{url:"/dashboard",controller:"DashboardController",templateUrl:"/views/dashboard.html"}).state("layout.ResetPasswordConfirmation",{url:"/reset-password/change-password/:hash",templateUrl:"/views/ResetPasswordConfirmation.html"}),d.html5Mode(!0),c.interceptors.push(["$injector",function(a){return{request:function(a){var b=localStorage.token;return a.headers.Authorization=b,a},response:function(a){return a}}}])}]),app.run(["$rootScope","$state",function(a,b){a.$on("$stateChangeSuccess",function(a,b,c,d,e){b.pageName&&(document.title="FitStop | "+b.pageName)})}]),app.constant("config",{baseAddress:"http://localhost:4857/api/"}),app.controller("DashboardController",["$scope","mealService","userService",function(a,b,c){a.user.getAllUsers(),a.meal={getMeal:function(){b.getMeal(a.currentUser.id,successCallback=function(b){a.mealInfo=b})}},a.userActions={deleteUser:function(b,d){c.deleteUser(b,successCallback=function(){a.allUsers.splice(d,1)})}}}]),app.controller("LayoutController",["$scope","$state","userService",function(a,b,c){a.currentUser=c.currentUser,a.user={email:"software@enginee.rs",password:"software",emailToReset:"",newPassword:"",hash:b.params.hash||"",login:function(){c.login(a.user.email,a.user.password,successCallback=function(){b.go("layout.dashboard")})},logout:function(){localStorage.clear(),a.user.email="",a.user.password="",b.go("layout.login")},getAllUsers:function(){c.allUsers(successCallback=function(b){a.allUsers=b,console.log(a.allUsers)})},resetUserPassword:function(a){c.resetPassword(a)},setNewPassword:function(a,b,d){c.setNewPassword(a,b,d)}},console.log(a.user.hash)}]),app.controller("LoginController",["$scope",function(a){}]),app.controller("RegisterController",["$scope","userService",function(a,b){a.registerNewUser=function(){b.register(a.register.firstName,a.register.lastName,a.register.address,a.register.email,a.register.phoneNumber,a.register.password,successCallback=function(b){a.newUser=b,console.log(a.newUser)})}}]),app.filter("correctedDate",function(){return function(a){if(a)return moment.utc(a).local().format("MM/DD/YYYY hh:mm A")}}),app.factory("mealService",["$http","config",function(a,b){var c={};return c.getMeal=function(c,d){return a({url:b.baseAddress+"meals/get/"+c,method:"GET"}).then(function(a){a.data&&successCallback(a.data)},function(){throw"userService.login: Failure"})},c}]),app.factory("userService",["$http","config",function(a,b){function c(){if(localStorage.currentUser){var a=JSON.parse(localStorage.currentUser);angular.copy(a,d.currentUser)}}var d={};return d.currentUser={},c(),d.login=function(d,e,f){return a({url:b.baseAddress+"users/login",method:"POST",data:{email:d,password:e}}).then(function(a){a.data&&(localStorage.currentUser=JSON.stringify(a.data.user),localStorage.token=a.data.token,c(),f())},function(){throw"userService.login: Failure"})},d.register=function(c,d,e,f,g,h,i){return a({url:b.baseAddress+"users/register",method:"POST",data:{firstName:c,lastName:d,address:e,email:f,phoneNumber:g,password:h}}).then(function(a){a.data&&i(a.data)},function(){throw"userService.login: Failure"})},d.allUsers=function(c){return a({url:b.baseAddress+"users/GetAll",method:"GET"}).then(function(a){a.data&&c(a.data)},function(){throw"userService.login: Failure"})},d.deleteUser=function(c,d){return a({url:b.baseAddress+"users/delete/"+c,method:"DELETE",data:{id:c}}).then(function(a){a.data&&d()},function(){throw"userService.login: Failure"})},d.resetPassword=function(c){return a({url:b.baseAddress+"users/ForgotPassword",method:"POST",data:{email:c}}).then(function(a){a.data&&console.log(a.data)},function(a){throw a.data.message})},d.setNewPassword=function(c,d,e){return a({url:b.baseAddress+"users/SetNewPassword",method:"PUT",data:{eMail:c,confirmHash:e,newPassword:d}}).then(function(a){a.data&&console.log(a.data)},function(a){throw a.data.message})},d}]);